\pgfplotstablecreatecol[create col/assign/.code={%
  \getthisrow{Etot}\entry%
  %\ifnum\pgfplotstablerow>0
  \pgfmathsetmacro{\entry}{min(\entry,\pgfmathaccuma)}%
  %\fi
  \edef\pgfmathaccuma{\entry}
  \pgfkeyslet{/pgfplots/table/create col/next content}\entry
} %
]{Emin}\ScanIsoPentane %
\pgfplotstablecreatecol[create col/assign/.code={%
  \getthisrow{Etot}\entryval%
  \getthisrow{Emin}\refval%
  %\ifnum\pgfplotstablerow>0
  \pgfmathsetmacro{\entryval}{\entryval - \refval}%
  \pgfmathsetmacro{\entryval}{\AUtoKJM * \entryval}%
  %\fi
  \edef\pgfmathaccuma{\entryval}
  \pgfkeyslet{/pgfplots/table/create col/next content}\entryval
} %
]{Erel}\ScanIsoPentane %
\pgfplotstablesave[columns={Tau,Etot,Erel}]{\ScanIsoPentane}{Results/ScanIsoPentane.save.dat}

\pgfplotstablecreatecol[create col/assign/.code={%
  \getthisrow{Etot}\entry%
  %\ifnum\pgfplotstablerow>0
  \pgfmathsetmacro{\entry}{min(\entry,\pgfmathaccuma)}%
  %\fi
  \edef\pgfmathaccuma{\entry}
  \pgfkeyslet{/pgfplots/table/create col/next content}\entry
}]{Emin}\ScanIPrOMe %
\pgfplotstablecreatecol[create col/assign/.code={%
  \getthisrow{Etot}\entryval%
  \getthisrow{Emin}\refval%
  %\ifnum\pgfplotstablerow>0
  \pgfmathsetmacro{\entryval}{\entryval - \refval}%
  \pgfmathsetmacro{\entryval}{\AUtoKJM * \entryval}%
  %\fi
  \edef\pgfmathaccuma{\entryval}
  \pgfkeyslet{/pgfplots/table/create col/next content}\entryval
} %
]{Erel}\ScanIPrOMe %
\pgfplotstablesave[columns={Tau,Etot,Erel}]
{\ScanIPrOMe}{Results/ScanIPrOMe.save.dat}
%
\pgfplotstablecreatecol[%
create col/assign/.code={%
  \getthisrow{Etot}\entry%
  %\ifnum\pgfplotstablerow>0
  \pgfmathsetmacro{\entry}{min(\entry,\pgfmathaccuma)}%
  %\fi
  \edef\pgfmathaccuma{\entry}
  \pgfkeyslet{/pgfplots/table/create col/next content}\entry
} %
]{Emin}\ScanIPrSMe %
\pgfplotstablecreatecol[create col/assign/.code={%
  \getthisrow{Etot}\entryval%
  \getthisrow{Emin}\refval%
  %\ifnum\pgfplotstablerow>0
  \pgfmathsetmacro{\entryval}{\entryval - \refval}%
  \pgfmathsetmacro{\entryval}{\AUtoKJM * \entryval}%
  %\fi
  \edef\pgfmathaccuma{\entryval}
  \pgfkeyslet{/pgfplots/table/create col/next content}\entryval
} %
]{Erel}\ScanIPrSMe %
\pgfplotstablesave[columns={Tau,Etot,Erel}]{\ScanIPrSMe}{Results/ScanIPrSMe.save.dat}
%
\pgfplotstablecreatecol[create col/assign/.code={
  \getthisrow{Etot}\entry %
  %\ifnum\pgfplotstablerow>0
  \pgfmathsetmacro{\entry}{min(\entry,\pgfmathaccuma)}%
  %\fi
  \edef\pgfmathaccuma{\entry}
  \pgfkeyslet{/pgfplots/table/create col/next content}\entry
} %
]{Emin}\ScanMeMeNEt %
\pgfplotstablecreatecol[%
create col/assign/.code={%
  \getthisrow{Etot}\entryval%
  \getthisrow{Emin}\refval%
  %\ifnum\pgfplotstablerow>0
  \pgfmathsetmacro{\entryval}{\entryval - \refval}%
  \pgfmathsetmacro{\entryval}{\AUtoKJM * \entryval}%
  %\fi
  \edef\pgfmathaccuma{\entryval}
  \pgfkeyslet{/pgfplots/table/create col/next content}\entryval
} %
]{Erel}\ScanMeMeNEt %
\pgfplotstablesave[columns={Tau,Etot,Erel}]{\ScanMeMeNEt}{Results/ScanMeMeNEt.save.dat}


\begin{figure}
\caption{Потенциалы внутреннего вращения молекул \cmpd{Isopentane}--\cmpd{Me2NEt}\label{fig:Internal:Rotation:Isopentanes}}
  \centerfloat{
\begin{tikzpicture}
  \begin{axis} [%
    legend style={draw=none},
    xlabel={\chemfig{[,0.875]H_3C-[:+30]\bullet(-[:+90]CH_3)-[:-30]\circ-[:+30]CH_3}/$\tau$,~\textdegree},
    xmin=-180, xmax=180,
    xtick={-180,-120,...,180},
    ylabel={$\Delta\Func{E}$,~\si{\kilo\joule\per\mole}},
    ymin=-1, ymax=32]
    \addplot [black,thick,smooth,domain=-180:180] table [x=Tau,y=Erel] 
    {Results/ScanIsopentane.save.dat};\addlegendentry{\chemfig{[,0.675]-[:+30](-[:+90])-[:-30]-[:+30]}~\cmpd{Isopentane}};
    \addplot [red,thick,smooth,domain=-180:180] table [x=Tau,y=Erel] 
    {Results/ScanIPrOMe.save.dat};\addlegendentry{\chemfig{[,0.675]-[:+30](-[:+90])-[:-30]O-[:+30]}~\cmpd{Me2CHOMe}};
    \addplot [brown,thick,smooth,domain=-180:180] table [x=Tau,y=Erel] 
    {Results/ScanIPrSMe.save.dat};\addlegendentry{\chemfig{[,0.675]-[:+30](-[:+90])-[:-30]S-[:+30]}~\cmpd{Me2CHSMe}};
    \addplot [blue,thick,smooth,domain=-180:180] table [x=Tau,y=Erel] 
    {Results/ScanMeMeNEt.save.dat};\addlegendentry{\chemfig{[,0.75]-[:+30]N(-[:+90])-[:-30]-[:+30]}~\cmpd{Me2NEt}};
\end{axis}
\end{tikzpicture}%
}
\end{figure}

